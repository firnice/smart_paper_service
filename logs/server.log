INFO:     Will watch for changes in these directories: ['/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [94322] using WatchFiles
INFO:     Started server process [94325]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     OCR upload received filename=54367e11dcc571a28f8bd743cdddf177.JPG bytes=333974 content_type=image/jpeg
INFO:     OCR request start model=Qwen/Qwen2-VL-72B-Instruct bytes=333974 detail=high filename=54367e11dcc571a28f8bd743cdddf177.JPG timeout=20s base_url=https://api.siliconflow.cn/v1
ERROR:    OCR request timed out or failed
Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 150, in extract_questions
    with request.urlopen(req, timeout=settings.timeout_seconds) as response:
         ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 489, in open
    response = self._open(req, data)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
                              '_open', req)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 466, in _call_chain
    result = func(*args)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1367, in https_open
    return self.do_open(http.client.HTTPSConnection, req,
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                        context=self._context)
                        ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1323, in do_open
    r = h.getresponse()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 1430, in getresponse
    response.begin()
    ~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 292, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socket.py", line 719, in readinto
    return self._sock.recv_into(b)
           ~~~~~~~~~~~~~~~~~~~~^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1304, in recv_into
    return self.read(nbytes, buffer)
           ~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1138, in read
    return self._sslobj.read(len, buffer)
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
TimeoutError: The read operation timed out
ERROR:    OCR failed
Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 150, in extract_questions
    with request.urlopen(req, timeout=settings.timeout_seconds) as response:
         ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 489, in open
    response = self._open(req, data)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
                              '_open', req)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 466, in _call_chain
    result = func(*args)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1367, in https_open
    return self.do_open(http.client.HTTPSConnection, req,
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                        context=self._context)
                        ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1323, in do_open
    r = h.getresponse()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 1430, in getresponse
    response.begin()
    ~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 292, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socket.py", line 719, in readinto
    return self._sock.recv_into(b)
           ~~~~~~~~~~~~~~~~~~~~^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1304, in recv_into
    return self.read(nbytes, buffer)
           ~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1138, in read
    return self._sslobj.read(len, buffer)
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
TimeoutError: The read operation timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/api/routes/ocr.py", line 25, in extract_questions
    items = ocr_service.extract_questions(image_bytes, content_type, file.filename or "upload")
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 158, in extract_questions
    raise RuntimeError(
        "OCR request timed out. Try a smaller image or increase SILICONFLOW_TIMEOUT_SECONDS."
    ) from exc
RuntimeError: OCR request timed out. Try a smaller image or increase SILICONFLOW_TIMEOUT_SECONDS.
INFO:     127.0.0.1:58677 - "POST /api/ocr/extract HTTP/1.1" 502 Bad Gateway
WARNING:  WatchFiles detected changes in 'app/core/llm_secrets.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [94325]
INFO:     Started server process [96072]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Will watch for changes in these directories: ['/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [96897] using WatchFiles
INFO:     Started server process [96900]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     OCR upload received filename=54367e11dcc571a28f8bd743cdddf177.JPG bytes=333974 content_type=image/jpeg
INFO:     OCR request start model=Qwen/Qwen2-VL-72B-Instruct bytes=333974 detail=high filename=54367e11dcc571a28f8bd743cdddf177.JPG timeout=180s base_url=https://api.siliconflow.cn/v1
INFO:     OCR response received length=1073 items=10 elapsed=22.36s
INFO:     127.0.0.1:59460 - "POST /api/ocr/extract HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'app/core/llm_secrets.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [96900]
INFO:     Started server process [766]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'app/core/llm_secrets.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [766]
INFO:     Started server process [917]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Will watch for changes in these directories: ['/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [1547] using WatchFiles
INFO:     Started server process [1550]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     OCR upload received filename=54367e11dcc571a28f8bd743cdddf177.JPG bytes=333974 content_type=image/jpeg
INFO:     OCR request start model=Qwen/Qwen3-VL-32B-Instruct bytes=333974 detail=high filename=54367e11dcc571a28f8bd743cdddf177.JPG timeout=180s base_url=https://api.siliconflow.cn/v1
INFO:     OCR response received length=1226 items=7 elapsed=16.88s
INFO:     127.0.0.1:60351 - "POST /api/ocr/extract HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'app/core/llm_secrets.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [1550]
INFO:     Started server process [4289]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'app/core/llm_secrets.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [4289]
INFO:     Started server process [4358]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     OCR upload received filename=54367e11dcc571a28f8bd743cdddf177.JPG bytes=333974 content_type=image/jpeg
INFO:     OCR request start model=zai-org/GLM-4.6V bytes=333974 detail=high filename=54367e11dcc571a28f8bd743cdddf177.JPG timeout=180s base_url=https://api.siliconflow.cn/v1
ERROR:    OCR request timed out or failed
Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 150, in extract_questions
    with request.urlopen(req, timeout=settings.timeout_seconds) as response:
         ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 489, in open
    response = self._open(req, data)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
                              '_open', req)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 466, in _call_chain
    result = func(*args)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1367, in https_open
    return self.do_open(http.client.HTTPSConnection, req,
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                        context=self._context)
                        ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1323, in do_open
    r = h.getresponse()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 1430, in getresponse
    response.begin()
    ~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 292, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socket.py", line 719, in readinto
    return self._sock.recv_into(b)
           ~~~~~~~~~~~~~~~~~~~~^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1304, in recv_into
    return self.read(nbytes, buffer)
           ~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1138, in read
    return self._sslobj.read(len, buffer)
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
TimeoutError: The read operation timed out
ERROR:    OCR failed
Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 150, in extract_questions
    with request.urlopen(req, timeout=settings.timeout_seconds) as response:
         ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 489, in open
    response = self._open(req, data)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
                              '_open', req)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 466, in _call_chain
    result = func(*args)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1367, in https_open
    return self.do_open(http.client.HTTPSConnection, req,
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                        context=self._context)
                        ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1323, in do_open
    r = h.getresponse()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 1430, in getresponse
    response.begin()
    ~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 292, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socket.py", line 719, in readinto
    return self._sock.recv_into(b)
           ~~~~~~~~~~~~~~~~~~~~^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1304, in recv_into
    return self.read(nbytes, buffer)
           ~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1138, in read
    return self._sslobj.read(len, buffer)
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
TimeoutError: The read operation timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/api/routes/ocr.py", line 25, in extract_questions
    items = ocr_service.extract_questions(image_bytes, content_type, file.filename or "upload")
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 158, in extract_questions
    raise RuntimeError(
        "OCR request timed out. Try a smaller image or increase SILICONFLOW_TIMEOUT_SECONDS."
    ) from exc
RuntimeError: OCR request timed out. Try a smaller image or increase SILICONFLOW_TIMEOUT_SECONDS.
INFO:     127.0.0.1:61026 - "POST /api/ocr/extract HTTP/1.1" 502 Bad Gateway
INFO:     OCR upload received filename=54367e11dcc571a28f8bd743cdddf177.JPG bytes=333974 content_type=image/jpeg
INFO:     OCR request start model=zai-org/GLM-4.6V bytes=333974 detail=high filename=54367e11dcc571a28f8bd743cdddf177.JPG timeout=180s base_url=https://api.siliconflow.cn/v1
ERROR:    OCR request timed out or failed
Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 150, in extract_questions
    with request.urlopen(req, timeout=settings.timeout_seconds) as response:
         ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 489, in open
    response = self._open(req, data)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
                              '_open', req)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 466, in _call_chain
    result = func(*args)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1367, in https_open
    return self.do_open(http.client.HTTPSConnection, req,
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                        context=self._context)
                        ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1323, in do_open
    r = h.getresponse()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 1430, in getresponse
    response.begin()
    ~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 292, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socket.py", line 719, in readinto
    return self._sock.recv_into(b)
           ~~~~~~~~~~~~~~~~~~~~^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1304, in recv_into
    return self.read(nbytes, buffer)
           ~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1138, in read
    return self._sslobj.read(len, buffer)
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
TimeoutError: The read operation timed out
ERROR:    OCR failed
Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 150, in extract_questions
    with request.urlopen(req, timeout=settings.timeout_seconds) as response:
         ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 489, in open
    response = self._open(req, data)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 506, in _open
    result = self._call_chain(self.handle_open, protocol, protocol +
                              '_open', req)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 466, in _call_chain
    result = func(*args)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1367, in https_open
    return self.do_open(http.client.HTTPSConnection, req,
           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                        context=self._context)
                        ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 1323, in do_open
    r = h.getresponse()
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 1430, in getresponse
    response.begin()
    ~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ~~~~~~~~~~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 292, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socket.py", line 719, in readinto
    return self._sock.recv_into(b)
           ~~~~~~~~~~~~~~~~~~~~^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1304, in recv_into
    return self.read(nbytes, buffer)
           ~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1138, in read
    return self._sslobj.read(len, buffer)
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
TimeoutError: The read operation timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/api/routes/ocr.py", line 25, in extract_questions
    items = ocr_service.extract_questions(image_bytes, content_type, file.filename or "upload")
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 158, in extract_questions
    raise RuntimeError(
        "OCR request timed out. Try a smaller image or increase SILICONFLOW_TIMEOUT_SECONDS."
    ) from exc
RuntimeError: OCR request timed out. Try a smaller image or increase SILICONFLOW_TIMEOUT_SECONDS.
INFO:     127.0.0.1:63517 - "POST /api/ocr/extract HTTP/1.1" 502 Bad Gateway
INFO:     OCR upload received filename=54367e11dcc571a28f8bd743cdddf177.JPG bytes=333974 content_type=image/jpeg
INFO:     OCR request start model=zai-org/GLM-4.6V bytes=333974 detail=high filename=54367e11dcc571a28f8bd743cdddf177.JPG timeout=180s base_url=https://api.siliconflow.cn/v1
ERROR:    OCR HTTP error 500: {"code":50507,"message":"Request processing failed due to an unknown error.","data":null}
ERROR:    OCR failed
Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 150, in extract_questions
    with request.urlopen(req, timeout=settings.timeout_seconds) as response:
         ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 189, in urlopen
    return opener.open(url, data, timeout)
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 495, in open
    response = meth(req, response)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 604, in http_response
    response = self.parent.error(
        'http', request, response, code, msg, hdrs)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 533, in error
    return self._call_chain(*args)
           ~~~~~~~~~~~~~~~~^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 466, in _call_chain
    result = func(*args)
  File "/opt/homebrew/Cellar/python@3.13/3.13.5/Frameworks/Python.framework/Versions/3.13/lib/python3.13/urllib/request.py", line 613, in http_error_default
    raise HTTPError(req.full_url, code, msg, hdrs, fp)
urllib.error.HTTPError: HTTP Error 500: Internal Server Error

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/api/routes/ocr.py", line 25, in extract_questions
    items = ocr_service.extract_questions(image_bytes, content_type, file.filename or "upload")
  File "/Users/liyiliang/Library/Mobile Documents/com~apple~CloudDocs/git-repos/smart_paper/lf-smart-paper-service/app/services/ocr_service.py", line 155, in extract_questions
    raise RuntimeError(f"OCR request failed ({exc.code}): {detail}") from exc
RuntimeError: OCR request failed (500): {"code":50507,"message":"Request processing failed due to an unknown error.","data":null}
INFO:     127.0.0.1:59249 - "POST /api/ocr/extract HTTP/1.1" 502 Bad Gateway
INFO:     127.0.0.1:59249 - "GET /api/health HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'app/core/llm_secrets.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [4358]
INFO:     Started server process [51303]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'app/core/llm_secrets.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [51303]
INFO:     Started server process [51352]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     OCR upload received filename=54367e11dcc571a28f8bd743cdddf177.JPG bytes=333974 content_type=image/jpeg
INFO:     OCR request start model=Pro/moonshotai/Kimi-K2.5 bytes=333974 detail=high filename=54367e11dcc571a28f8bd743cdddf177.JPG timeout=180s base_url=https://api.siliconflow.cn/v1
INFO:     OCR response received length=1276 items=7 elapsed=146.22s
INFO:     127.0.0.1:59888 - "POST /api/ocr/extract HTTP/1.1" 200 OK
INFO:     127.0.0.1:60878 - "OPTIONS /api/variants/generate HTTP/1.1" 200 OK
INFO:     127.0.0.1:60878 - "POST /api/variants/generate HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'app/core/llm_secrets.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [51352]
INFO:     Started server process [59627]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'app/core/llm_secrets.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [59627]
INFO:     Started server process [59646]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'app/services/ocr_service.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [59646]
INFO:     Started server process [60928]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'app/services/ocr_service.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [60928]
INFO:     Started server process [60973]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     OCR upload received filename=54367e11dcc571a28f8bd743cdddf177.JPG bytes=333974 content_type=image/jpeg
INFO:     OCR request start model=Qwen/Qwen3-VL-32B-Instruct bytes=333974 detail=high filename=54367e11dcc571a28f8bd743cdddf177.JPG timeout=180s base_url=https://api.siliconflow.cn/v1
INFO:     OCR response received length=1384 items=7 elapsed=96.74s
INFO:     127.0.0.1:62450 - "POST /api/ocr/extract HTTP/1.1" 200 OK
