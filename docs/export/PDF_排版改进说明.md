# PDF 导出排版改进说明

## 🎨 改进内容

### 1. 页面布局优化
- ✅ **增加页边距**: 2.5cm（原来 2cm）
- ✅ **标题居中**: 20号字体，加粗
- ✅ **装饰线**: 标题下方添加蓝色装饰线

### 2. 原题和变式题分页
- ✅ **原题独立页**: 原题在第一页
- ✅ **变式题新页**: 变式题从第二页开始
- ✅ **避免挤在一起**: 每个部分有充足空间

### 3. 题目框格设计
- ✅ **原题框格**: 浅灰色背景 + 灰色边框
- ✅ **变式题框格**: 浅蓝色背景 + 蓝色边框
- ✅ **内边距**: 15mm，题目不贴边
- ✅ **题号突出**: 蓝色粗体，14号字

### 4. 答题空间
- ✅ **答题区域提示**: 【答题区域】灰色文字
- ✅ **4行答题线**: 每题4行横线供孩子书写
- ✅ **充足间距**: 题目和答题线之间有间距

### 5. 题目间分隔
- ✅ **分隔线**: 变式题之间有浅灰色分隔线
- ✅ **大间距**: 每道题之间 1cm 空白
- ✅ **KeepTogether**: 每道题目完整保持在同一页

### 6. 视觉层次
- ✅ **标题层级清晰**:
  - 文档标题 20号
  - 章节标题 16号（📝 原题、🔄 变式题）
  - 题号 14号
  - 内容 12号
- ✅ **颜色区分**:
  - 标题深灰色
  - 题号蓝色
  - 提示浅灰色
- ✅ **背景色**: 原题和变式题用不同背景色

### 7. 页脚标识
- ✅ **页脚文字**: "—— 智能错题本练习卷 ——"
- ✅ **居中对齐**: 9号字体，浅灰色

## 📊 排版对比

### 改进前
```
标题
原题：题目内容
变式题：
1. 题目1
2. 题目2
3. 题目3
```
**问题**: 所有内容挤在一页，没有间距，难以区分

### 改进后
```
==================
     标题
==================

📝 原题
┌─────────────────────────┐
│ 题目内容（有背景色）      │
└─────────────────────────┘
【答题区域】
_________________________
_________________________

[新页]

🔄 变式题（举一反三）

第 1 题
┌─────────────────────────┐
│ 题目1（蓝色背景）         │
└─────────────────────────┘
【答题区域】
_________________________

─────────────────────────

第 2 题
...
```
**改进**: 分页清晰，框格美观，间距充足，视觉舒适

## 🎯 效果对比

| 项目 | 改进前 | 改进后 |
|------|--------|--------|
| 页面布局 | 紧凑，1页 | 舒展，2-3页 |
| 题目区分 | 纯文字 | 彩色框格 |
| 答题空间 | 无 | 4行横线 |
| 分隔效果 | 难以区分 | 清晰分隔 |
| 视觉层次 | 扁平 | 层次分明 |
| 打印效果 | 拥挤 | 专业美观 |

## 📝 使用示例

### API 调用
```bash
curl -X POST http://localhost:8000/api/export \
  -H "Content-Type: application/json" \
  -d '{
    "title": "小学数学练习卷",
    "original_text": "1. 小明有 8 个苹果，小红有 5 个苹果，他们一共有多少个苹果？",
    "variants": [
      "小明有 10 个橘子，小红有 7 个橘子，他们一共有多少个橘子？",
      "小李有 12 个梨，小王有 9 个梨，他们一共有多少个梨？",
      "小张有 15 个桃子，小赵有 11 个桃子，他们一共有多少个桃子？"
    ],
    "include_images": false
  }'
```

### Python 测试
```python
from app.services.export_service import _generate_pdf

pdf_bytes = _generate_pdf(
    title='小学数学练习卷',
    original_text='1. 小明有 8 个苹果...',
    variants=['变式题1', '变式题2', '变式题3']
)

with open('test.pdf', 'wb') as f:
    f.write(pdf_bytes)
```

## 🔧 可配置项

未来可以添加的配置选项：

1. **答题空间行数**: 可调整（当前固定 4 行）
2. **题目框格颜色**: 可自定义主题色
3. **分页策略**:
   - 所有题目一页
   - 每道题一页
   - 自适应分页（当前）
4. **字体大小**: 可调整适应不同年龄段
5. **是否显示答题空间**: 可选隐藏

## ✨ 技术细节

### 使用的 reportlab 组件
- `SimpleDocTemplate`: 文档模板
- `Paragraph`: 段落文本
- `Spacer`: 空白间距
- `Table`: 框格和横线
- `TableStyle`: 样式（背景色、边框、内边距）
- `PageBreak`: 强制分页
- `KeepTogether`: 保持元素在同一页

### 颜色方案
- 标题蓝: `#0066cc`
- 原题背景: `#fafafa`
- 原题边框: `#cccccc`
- 变式题背景: `#f8f9ff`
- 变式题边框: `#b3c6ff`
- 分隔线: `#e0e0e0`

## 📦 文件位置

- **服务代码**: `app/services/export_service.py`
- **测试文件**: `test_export_improved.pdf`
- **API 端点**: `POST /api/export`

## 🎉 总结

改进后的 PDF 排版：
- ✅ **视觉更舒适**: 不再挤在一起
- ✅ **结构更清晰**: 原题和变式题明确分离
- ✅ **更易书写**: 有专门的答题空间
- ✅ **更专业**: 框格设计美观，适合打印
- ✅ **更实用**: 符合学生做题习惯

适合直接打印给孩子练习使用！ 📄✨
